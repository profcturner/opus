OPUS UPGRADE NOTES

0. Running Debian?
------------------

If you are running Debian, just install the new version of OPUS using the
command in the INSTALL guide, and you are done. You might want to backup
your database first (see step 3), but dbconfig-common does this as well for you.


If you are not running Debian, then for upgrading from one 4.x release to
another, things are relatively straightforward:

  a) backup the database

      e.g. mysqldump -u root -p opus > backup_opus.sql
      (you will be asked for your MySQL root password).

  b) optionally back up any other files, configuration and so on.

  c) unarchive the new release and copy it over the old one.


If you are upgrading from 3.x, the transition from version 3.x to 4.x is by
far the most major yet, and we expect it to the most major change ever.

As a result the upgrade is somewhat more tricky, so read this document
carefully.


1. Prepare a new location for version 4
---------------------------------------

Since the application is quite different, we recommend a new directory is
used to unpack the files for version 4. You can call it opus4 for now
and rename it later.

Unpack the archive into this directory. You should put this somewhere
sensible, such as /usr/share/opus on a *nix system.


2. Close down your 3.x instance
-------------------------------

To avoid data being changed after backup, it's advisable to close OPUS 3.x.
You can do this by editing config.php in the include directory so that

// Closed for maintenance
$conf['closed'] = TRUE;

and save the file. OPUS 3.x will now be closed.


3. Backup your database
-----------------------

This is *extremely* important. The transition is complex, so to ensure all
data is intact in case of problems, ensure you do the backup. The command
will be something like

mysqldump -u root -p opus > opus_pre_4_backup.sql
(type password for mysql root user)

You can of course archive the sql file which should compress very well. e.g.

gzip opus_pre_4_backup.sql


4. Create a preferences database
--------------------------------

OPUS v4 uses a preference system to save various information. It is possible
to use the existing database for this, but it's advisable to use a separate
database since it will allow other UU software packages you might use in the
future to share preferences.

mysql -u root -p
(type password for mysql root user)
create database preferences;
use preferences;
grant all on preferences.* to opus_user@localhost identified by 'password_here';
source /usr/share/uuwaf/sql_patch/preferences-schema.sql

adjust pathnames, usernames and passwords as needed.


5. Upgrade the OPUS database
----------------------------

If you didn't backup the OPUS database again, I repeat, you really should do so
(see step 3).

From the command prompt run

mysql -u root -p opus < sql_patch/patch_3.3.x_4.0.0.sql
(type password for mysql root user)

to patch the database to version 4.


6. Copy all materials stored in the file system rather than the database
------------------------------------------------------------------------

If you have made the OPUS tree in the a new directory, then copy over
the various static files, such as resources and photos.

e.g.

cp -R /usr/share/opus/photos /usr/share/opus4/
cp -R /usr/share/opus/resources /usr/share/opus4/

You should also go to your log directory, probably /var/log/opus/

and rename the access log to general

mv /var/log/opus/access.log /var/log/opus/general.log


7. The Rest
-----------

Now jump to step 8 of the install guide.

When you are finished, probably you want to move version 3 out of the way

mv /usr/share/opus /usr/share/opus-old

and move version 4 to the original place

mv /usr/share/opus4 /usr/share/opus

Let us know if you need help by filing a support ticket.

http://foss.ulster.ac.uk/projects/opus/